<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>수질분석 의뢰서</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6",
                        "background-light": "#F8FAFC",
                        "background-dark": "#18181B",
                    },
                    fontFamily: {
                        display: ["Noto Sans KR", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "12px",
                    },
                },
            },
        };
    </script>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="water-style.css">
</head>

<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar water-navbar">
        <!-- 로고 -->
        <div class="navbar-brand">
            <a href="../index.html" class="back-btn" title="메인으로">←</a>
            <span class="brand-icon">💧</span>
            <span class="brand-text">수질분석</span>
        </div>

        <!-- 메인 네비게이션 -->
        <div class="navbar-nav">
            <button class="nav-btn active" data-view="form" title="시료 접수">
                <span class="nav-btn-icon">✏️</span>
            </button>
            <button class="nav-btn" data-view="list" title="접수 목록">
                <span class="nav-btn-icon">📊</span>
            </button>
        </div>

        <div class="navbar-divider"></div>

        <!-- 폼 액션 -->
        <div class="navbar-actions">
            <button type="button" id="navResetBtn" class="action-btn-icon reset" title="초기화">
                <span>🔄</span>
            </button>
            <button type="button" id="navSubmitBtn" class="action-btn-icon submit" title="접수 등록">
                <span>✅</span>
            </button>
        </div>

        <div class="navbar-spacer"></div>

        <!-- 유틸리티 -->
        <div class="navbar-utils">
            <button type="button" id="exportBtn" class="util-btn" title="엑셀 내보내기">📥</button>
            <button type="button" id="saveJsonBtn" class="util-btn" title="JSON 저장">💾</button>
            <label for="loadJsonInput" class="util-btn" title="JSON 불러오기">
                📂
                <input type="file" id="loadJsonInput" accept=".json" hidden>
            </label>
        </div>

        <div class="navbar-divider"></div>

        <!-- 자동 저장 -->
        <div class="navbar-autosave">
            <label class="autosave-toggle" title="자동저장">
                <input type="checkbox" id="autoSaveToggle">
                <span class="toggle-track"></span>
            </label>
            <button type="button" id="selectAutoSaveFolderBtn" class="autosave-folder-btn" title="저장 폴더 변경">
                📁
            </button>
            <span id="autoSaveStatus" class="autosave-status">
                <span class="status-indicator"></span>
            </span>
        </div>
    </nav>

    <!-- 메인 콘텐츠 -->
    <main class="main-content">
        <!-- 시료 접수 폼 뷰 -->
        <div id="formView" class="view active">

            <form id="sampleForm" class="sample-form">
                <div class="form-two-column">
                    <!-- 왼쪽: 의뢰인 정보 + 의뢰내용 -->
                    <div class="form-left-column">
                        <!-- 의뢰인 정보 카드 -->
                        <div class="form-card">
                            <div class="card-header">
                                <span class="card-icon">👤</span>
                                <h3>의뢰인 정보</h3>
                                <div class="reception-method-group">
                                    <button type="button" class="reception-method-btn" data-method="우편" title="우편">
                                        <span class="method-icon">📮</span>
                                    </button>
                                    <button type="button" class="reception-method-btn" data-method="팩스" title="팩스">
                                        <span class="method-icon">📠</span>
                                    </button>
                                    <button type="button" class="reception-method-btn" data-method="방문" title="방문">
                                        <span class="method-icon">🚶</span>
                                    </button>
                                    <button type="button" class="reception-method-btn" data-method="이메일" title="이메일">
                                        <span class="method-icon">📧</span>
                                    </button>
                                </div>
                                <input type="hidden" id="receptionMethod" name="receptionMethod" required>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-field">
                                        <label for="receptionNumber">접수번호</label>
                                        <input type="text" id="receptionNumber" name="receptionNumber"
                                            placeholder="자동 생성">
                                    </div>
                                    <div class="form-field">
                                        <label for="date">접수일자</label>
                                        <input type="date" id="date" name="date" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-field">
                                        <label for="name">성명 <span class="required">*</span></label>
                                        <input type="text" id="name" name="name" required placeholder="의뢰인 성명 (법인의 경우 대표자)" autocomplete="name">
                                    </div>
                                    <div class="form-field">
                                        <label for="birthDate">생년월일</label>
                                        <input type="date" id="birthDate" name="birthDate" placeholder="생년월일">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-field">
                                        <label for="phoneNumber">연락처 <span class="required">*</span></label>
                                        <input type="tel" id="phoneNumber" name="phoneNumber" required
                                            placeholder="010-0000-0000" autocomplete="tel">
                                    </div>
                                </div>
                                <div class="form-row single">
                                    <div class="form-field full">
                                        <label for="addressPostcode">주소 (법인소재지)</label>
                                        <div class="address-group">
                                            <div class="address-row">
                                                <input type="text" id="addressPostcode" name="addressPostcode" readonly
                                                    placeholder="우편번호" class="postcode-input" autocomplete="postal-code">
                                                <button type="button" id="searchAddressBtn" class="btn-search">
                                                    🔍 주소 검색
                                                </button>
                                            </div>
                                            <input type="text" id="addressRoad" name="addressRoad" readonly
                                                placeholder="도로명 주소" autocomplete="street-address">
                                            <input type="text" id="addressDetail" name="addressDetail" placeholder="상세 주소 입력" autocomplete="address-line2">
                                        </div>
                                        <input type="hidden" id="address" name="address">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 의뢰내용 카드 -->
                        <div class="form-card">
                            <div class="card-header">
                                <span class="card-icon">💧</span>
                                <h3>의뢰내용</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-row">
                                    <div class="form-field">
                                        <label for="sampleName">시료명 <span class="required">*</span></label>
                                        <input type="text" id="sampleName" name="sampleName" required placeholder="예: 지하수, 하천수 등">
                                    </div>
                                    <div class="form-field">
                                        <label for="waterType">수질 종류 <span class="required">*</span></label>
                                        <select id="waterType" name="waterType" required>
                                            <option value="">선택하세요</option>
                                            <option value="지하수">🕳️ 지하수</option>
                                            <option value="지표수">🌊 지표수</option>
                                            <option value="기타">📦 기타</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-field">
                                        <label for="sampleCount">시료수 <span class="required">*</span></label>
                                        <div class="sample-count-group">
                                            <input type="number" id="sampleCount" name="sampleCount" required min="1" value="1" placeholder="시료 개수">
                                            <span class="sample-count-unit">점</span>
                                        </div>
                                    </div>
                                    <div class="form-field">
                                        <label for="mainCrop">주작목</label>
                                        <input type="text" id="mainCrop" name="mainCrop" placeholder="예: 벼, 고추, 사과 등">
                                    </div>
                                </div>
                                <div class="form-row single">
                                    <div class="form-field full">
                                        <label for="samplingLocation">채취장소 <span class="required">*</span></label>
                                        <input type="text" id="samplingLocation" name="samplingLocation" required placeholder="시료를 채취한 장소 (예: 봉화군 봉화읍 내성리 123)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 오른쪽: 목적 + 검사항목 -->
                    <div class="form-right-column">
                        <!-- 목적(용도) 카드 -->
                        <div class="form-card">
                            <div class="card-header">
                                <span class="card-icon">🎯</span>
                                <h3>목적 (용도)</h3>
                            </div>
                            <div class="card-body">
                                <div class="purpose-options">
                                    <label class="purpose-option">
                                        <input type="radio" name="purpose" value="참고용" checked>
                                        <span class="purpose-label">
                                            <span class="purpose-icon">📋</span>
                                            <span class="purpose-text">참고용</span>
                                        </span>
                                    </label>
                                    <label class="purpose-option">
                                        <input type="radio" name="purpose" value="인증용-무농약">
                                        <span class="purpose-label">
                                            <span class="purpose-icon">🍃</span>
                                            <span class="purpose-text">인증용 (무농약)</span>
                                        </span>
                                    </label>
                                    <label class="purpose-option">
                                        <input type="radio" name="purpose" value="인증용-유기">
                                        <span class="purpose-label">
                                            <span class="purpose-icon">♻️</span>
                                            <span class="purpose-text">인증용 (유기)</span>
                                        </span>
                                    </label>
                                    <label class="purpose-option">
                                        <input type="radio" name="purpose" value="인증용-GAP">
                                        <span class="purpose-label">
                                            <span class="purpose-icon">✅</span>
                                            <span class="purpose-text">인증용 (GAP)</span>
                                        </span>
                                    </label>
                                    <label class="purpose-option">
                                        <input type="radio" name="purpose" value="기타">
                                        <span class="purpose-label">
                                            <span class="purpose-icon">📦</span>
                                            <span class="purpose-text">기타</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 검사항목 카드 -->
                        <div class="form-card">
                            <div class="card-header">
                                <span class="card-icon">🔬</span>
                                <h3>검사항목</h3>
                            </div>
                            <div class="card-body">
                                <div class="test-items-options">
                                    <label class="test-item-option">
                                        <input type="radio" name="testItems" value="생활용수" checked>
                                        <span class="test-item-label">
                                            <span class="test-item-icon">🚰</span>
                                            <span class="test-item-info">
                                                <span class="test-item-name">생활용수</span>
                                                <span class="test-item-count">20항목</span>
                                            </span>
                                        </span>
                                    </label>
                                    <label class="test-item-option">
                                        <input type="radio" name="testItems" value="농업용수">
                                        <span class="test-item-label">
                                            <span class="test-item-icon">🌾</span>
                                            <span class="test-item-info">
                                                <span class="test-item-name">농업용수</span>
                                                <span class="test-item-count">15항목</span>
                                            </span>
                                        </span>
                                    </label>
                                </div>

                                <!-- 검사항목 상세 정보 -->
                                <div class="test-items-detail" id="testItemsDetail">
                                    <div class="test-items-info living-water active" id="livingWaterItems">
                                        <h4>생활용수 검사항목 (20항목)</h4>
                                        <p class="test-items-list">pH, 탁도, 색도, 냄새, 맛, 경도, 과망간산칼륨소비량, 암모니아성질소, 질산성질소, 염소이온, 철, 망간, 구리, 아연, 불소, 대장균군, 일반세균, 황산이온, 알루미늄, 증발잔류물</p>
                                    </div>
                                    <div class="test-items-info agricultural-water" id="agriculturalWaterItems">
                                        <h4>농업용수 검사항목 (15항목)</h4>
                                        <p class="test-items-list">pH, EC, 화학적산소요구량(COD), 부유물질(SS), 용존산소(DO), 총질소, 총인, 카드뮴, 비소, 수은, 납, 크롬, 구리, 아연, 대장균군</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 비고 카드 -->
                        <div class="form-card">
                            <div class="card-header">
                                <span class="card-icon">📝</span>
                                <h3>비고</h3>
                            </div>
                            <div class="card-body">
                                <textarea id="note" name="note" rows="3" placeholder="추가 메모 사항을 입력하세요"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </form>
        </div>

        <!-- 접수 목록 뷰 -->
        <div id="listView" class="view">
            <div class="view-header-top">
                <div class="header-left">
                    <h2>수질분석 접수 목록</h2>
                    <span class="record-count" id="recordCount">0건</span>
                </div>
                <div class="header-right">
                    <div class="view-toggle">
                        <button type="button" id="viewToggleBtn" class="btn-view-toggle" title="전체 보기/기본 보기">
                            <span class="toggle-icon">👁️</span>
                            <span class="toggle-text">전체 보기</span>
                        </button>
                    </div>
                    <button type="button" id="btnStatistics" class="btn-statistics" title="통계">
                        📊 통계
                    </button>
                    <button type="button" id="btnLabelPrint" class="btn-label-print" title="선택한 항목 라벨 인쇄">
                        🏷️ 라벨 인쇄
                    </button>
                    <button type="button" id="btnBulkDelete" class="btn-bulk-delete" title="선택한 항목 일괄 삭제">
                        🗑️ 선택 삭제
                    </button>
                    <button type="button" id="openSearchModalBtn" class="btn-search-open" title="검색">
                        🔍 검색
                    </button>
                </div>
            </div>

            <div class="table-wrapper">
                <table id="logTable" class="data-table">
                    <thead>
                        <tr>
                            <th class="col-checkbox"><input type="checkbox" id="selectAll" title="전체 선택"></th>
                            <th class="col-complete">완료</th>
                            <th>접수번호</th>
                            <th>접수일자</th>
                            <th>성명</th>
                            <th>시료명</th>
                            <th>수질종류</th>
                            <th>시료수</th>
                            <th>채취장소</th>
                            <th>목적</th>
                            <th>검사항목</th>
                            <th>연락처</th>
                            <th>통보방법</th>
                            <th class="col-note">비고</th>
                            <th class="col-action">관리</th>
                        </tr>
                    </thead>
                    <tbody id="logTableBody">
                        <!-- 데이터가 여기에 추가됩니다 -->
                    </tbody>
                </table>
                <div id="emptyState" class="empty-state">
                    <div class="empty-icon">📭</div>
                    <p>등록된 접수 내역이 없습니다</p>
                    <button type="button" class="btn-go-form">새 시료 접수하기</button>
                </div>
            </div>
        </div>
    </main>

    <!-- 주소 검색 모달 -->
    <div id="addressModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📍 주소 검색</h3>
                <button type="button" class="modal-close" id="closeAddressModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="daumPostcodeContainer" class="postcode-container"></div>
            </div>
        </div>
    </div>

    <!-- 통계 모달 -->
    <div id="statisticsModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📊 수질분석 접수 통계</h3>
                <button type="button" class="modal-close" id="closeStatisticsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stats-container">
                    <div class="stats-summary">
                        <div class="stat-card total">
                            <div class="stat-icon">📋</div>
                            <div class="stat-info">
                                <span class="stat-value" id="statTotalCount">0</span>
                                <span class="stat-label">총 접수</span>
                            </div>
                        </div>
                        <div class="stat-card completed">
                            <div class="stat-icon">✅</div>
                            <div class="stat-info">
                                <span class="stat-value" id="statCompletedCount">0</span>
                                <span class="stat-label">완료</span>
                            </div>
                        </div>
                        <div class="stat-card pending">
                            <div class="stat-icon">⏳</div>
                            <div class="stat-info">
                                <span class="stat-value" id="statPendingCount">0</span>
                                <span class="stat-label">미완료</span>
                            </div>
                        </div>
                    </div>
                    <div class="stats-details">
                        <div class="stats-section">
                            <h4>💧 수질 종류별</h4>
                            <div class="stats-chart" id="statsByWaterType"></div>
                        </div>
                        <div class="stats-section">
                            <h4>🎯 목적별</h4>
                            <div class="stats-chart" id="statsByPurpose"></div>
                        </div>
                        <div class="stats-section">
                            <h4>🔬 검사항목별</h4>
                            <div class="stats-chart" id="statsByTestItems"></div>
                        </div>
                        <div class="stats-section">
                            <h4>📅 월별 접수 현황</h4>
                            <div class="stats-chart" id="statsByMonth"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="closeStatisticsBtn" class="btn-cancel">닫기</button>
            </div>
        </div>
    </div>

    <!-- 접수 목록 검색 모달 -->
    <div id="listSearchModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-search">
            <div class="modal-header">
                <div class="modal-title">
                    <span class="material-icons-outlined">search</span>
                    <h3>검색</h3>
                </div>
                <button type="button" class="modal-close" id="closeSearchModal">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="search-modal-form">
                    <div class="search-form-group">
                        <label for="searchDateInput">접수일자</label>
                        <div class="search-input-row">
                            <div class="search-input-wrapper">
                                <input type="date" id="searchDateInput" class="search-input">
                            </div>
                            <button type="button" id="clearSearchDate" class="btn-clear-field">초기화</button>
                        </div>
                    </div>
                    <div class="search-form-group">
                        <label for="searchTextInput">성명 / 접수번호</label>
                        <input type="text" id="searchTextInput" placeholder="성명 또는 접수번호 입력..." class="search-input">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="resetSearchBtn" class="btn-reset">전체 초기화</button>
                <button type="button" id="applySearchBtn" class="btn-search-apply">검색</button>
            </div>
        </div>
    </div>

    <!-- 등록 결과 모달 -->
    <div id="registrationResultModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📋 등록 결과</h3>
                <button type="button" class="modal-close" id="closeRegistrationModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="result-table-wrapper">
                    <table class="result-table">
                        <tbody id="resultTableBody">
                            <!-- 등록된 데이터가 여기에 표시됩니다 -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="closeResultBtn" class="btn-cancel">닫기</button>
                <button type="button" id="exportResultBtn" class="btn-confirm">엑셀로 내보내기</button>
            </div>
        </div>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="../bonghwaData.js"></script>
    <script src="water-script.js"></script>
</body>

</html>
