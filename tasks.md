# 시료 접수 대장 앱 개발 작업 내역

## 프로젝트 개요
- **프로젝트명**: sample-log-electron
- **GitHub**: https://github.com/bluesky78060/sample-log-electron
- **배포**:
  - 데스크톱: GitHub Releases (Windows .exe)
  - 웹: GitHub Pages (https://bluesky78060.github.io/sample-log-electron/)

---

## 시료 유형별 개발 현황

| 시료 유형 | 상태 | 비고 |
|-----------|------|------|
| 🌱 토양 | ✅ 완료 | 필지별 개별 접수, 자동 저장 |
| 💧 수질 | ✅ 완료 | 채취장소별 개별 접수, 생활용수/농업용수 검사항목 |
| 🧫 잔류농약 | ⏳ 예정 | |
| 🐄 가축분뇨퇴비 | ⏳ 예정 | |
| ⚠️ 중금속 | ⏳ 예정 | |

### 완료: 토양 시료 접수 대장
- 토양 시료 접수 폼
- 필지 정보 관리 (주소, 작물, 면적)
- 목적(용도): 일반재배, 무농약, 유기, GAP, 저탄소
- 구분: 논, 밭, 과수, 시설
- 필지별 개별 접수번호 부여
- 자동 저장 (auto-save-soil.json)

### 완료: 수질 시료 접수 대장
- 수질 시료 접수 폼
- 채취장소별 개별 접수번호 부여 (다중 채취장소 지원)
- 채취장소별 주작목 입력
- 검사항목: 생활용수(20항목), 농업용수(15항목)
- 생활용수: pH, EC, 총대장균군, 질산성질소, 염소이온, 카드뮴, 비소, 시안, 수은, 납, 6가크롬, 셀레늄, 페놀, 벤젠, 톨루엔, 에틸벤젠, 크실렌, 트리클로로에틸렌, 테트라클로로에틸렌, 1,1,1-트리클로로에탄
- 농업용수: pH, EC, COD, SS, DO, 총질소, 총인, 카드뮴, 비소, 수은, 납, 크롬, 구리, 아연, 대장균군
- 자동 저장 (auto-save-water.json)

### 예정 작업: 추가 시료 유형

> **중요**: 각 시료 유형별로 **시료 접수 폼**과 **접수 목록 테이블**이 다르게 구성되어야 함

---

### 🌱 토양 시료 (현재 완료)

#### 시료 접수 폼
| 필드명 | 설명 |
|--------|------|
| 접수번호 | 자동 생성 |
| 접수일자 | 날짜 선택 |
| 성명 | 민원인 성명 |
| 전화번호 | 연락처 |
| 주소 | 우편번호 + 도로명 + 상세주소 |
| 구분 | 논, 밭, 과수, 시설 |
| 목적(용도) | 일반재배, 무농약, 유기, GAP, 저탄소 |
| 필지 정보 | 필지 주소, 작물명, 면적 (다중 등록 가능) |
| 수령 방법 | 우편, 이메일, 팩스, 직접방문 |
| 비고 | 추가 메모 |

#### 접수 목록 테이블 컬럼
`완료 | 접수번호 | 접수일자 | 구분 | 목적 | 성명 | 우편번호 | 주소 | 필지주소 | 작물명 | 면적 | 전화번호 | 수령방법 | 비고 | 관리`

---

### 💧 수질 시료 (✅ 완료)

#### 시료 접수 폼
| 필드명 | 설명 |
|--------|------|
| 접수번호 | 자동 생성 (채취장소별 개별 번호) |
| 접수일자 | 날짜 선택 |
| 성명 | 민원인 성명 |
| 전화번호 | 연락처 |
| 주소 | 우편번호 + 도로명 + 상세주소 |
| **시료명** | 지하수, 하천수, 저수지, 수돗물, 기타 |
| **채취장소** | 리+지번 (다중 입력 가능) |
| **주작목** | 채취장소별 주작목 |
| **목적** | 참고용, 민원, 기타 |
| **검사항목** | 생활용수(20항목), 농업용수(15항목) |
| 수령 방법 | 통보방법 선택 |
| 비고 | 추가 메모 |

#### 접수 목록 테이블 컬럼
`완료 | 접수번호 | 접수일자 | 성명 | 주소 | 시료명 | 시료수 | 채취장소 | 주작목 | 목적 | 검사항목 | 전화번호 | 통보방법 | 비고 | 관리`

---

### 🧫 잔류농약 시료 (예정)

#### 시료 접수 폼
| 필드명 | 설명 |
|--------|------|
| 접수번호 | 자동 생성 |
| 접수일자 | 날짜 선택 |
| 성명 | 민원인 성명 |
| 전화번호 | 연락처 |
| 주소 | 우편번호 + 도로명 + 상세주소 |
| **농산물명** | 검사 대상 농산물 (작물 선택) |
| **재배지 주소** | 농산물 재배지 |
| **출하 예정일** | 농산물 출하 예정일 |
| **인증 종류** | 무농약, 유기, GAP, 저탄소, 일반 |
| 수령 방법 | 우편, 이메일, 팩스, 직접방문 |
| 비고 | 추가 메모 |

#### 접수 목록 테이블 컬럼
`완료 | 접수번호 | 접수일자 | 성명 | 농산물명 | 재배지 | 출하예정일 | 인증종류 | 전화번호 | 수령방법 | 비고 | 관리`

---

### 🐄 가축분뇨퇴비 시료 (예정)

#### 시료 접수 폼
| 필드명 | 설명 |
|--------|------|
| 접수번호 | 자동 생성 |
| 접수일자 | 날짜 선택 |
| 성명/업체명 | 생산자 또는 업체명 |
| 전화번호 | 연락처 |
| 주소 | 우편번호 + 도로명 + 상세주소 |
| **퇴비 종류** | 돈분, 우분, 계분, 혼합, 기타 |
| **생산지 주소** | 퇴비 생산 장소 |
| **생산일자** | 퇴비 생산일 |
| **검사 목적** | 품질검사, 부숙도검사, 성분분석, 기타 |
| 수령 방법 | 우편, 이메일, 팩스, 직접방문 |
| 비고 | 추가 메모 |

#### 접수 목록 테이블 컬럼
`완료 | 접수번호 | 접수일자 | 성명/업체명 | 퇴비종류 | 생산지 | 생산일자 | 검사목적 | 전화번호 | 수령방법 | 비고 | 관리`

---

### ⚠️ 중금속 시료 (예정)

#### 시료 접수 폼
| 필드명 | 설명 |
|--------|------|
| 접수번호 | 자동 생성 |
| 접수일자 | 날짜 선택 |
| 성명 | 민원인 성명 |
| 전화번호 | 연락처 |
| 주소 | 우편번호 + 도로명 + 상세주소 |
| **시료 종류** | 토양, 농산물, 용수, 기타 |
| **채취 위치** | 시료 채취 장소 |
| **채취일자** | 시료 채취일 |
| **검사 항목** | 납, 카드뮴, 비소, 수은, 크롬, 구리, 아연, 니켈 (다중 선택) |
| **오염 의심 원인** | 공장, 폐기물, 농약, 자연발생, 기타 |
| 수령 방법 | 우편, 이메일, 팩스, 직접방문 |
| 비고 | 추가 메모 |

#### 접수 목록 테이블 컬럼
`완료 | 접수번호 | 접수일자 | 성명 | 시료종류 | 채취위치 | 채취일자 | 검사항목 | 오염원인 | 전화번호 | 수령방법 | 비고 | 관리`

---

### 구현 방안

#### 옵션 1: 탭 기반 분리
- 네비게이션 바에 시료 유형별 탭 추가
- 각 탭 클릭 시 해당 시료 유형의 폼/목록으로 전환
- 데이터는 `sampleType` 필드로 구분하여 저장

#### 옵션 2: 별도 페이지 분리
- 각 시료 유형별로 별도 HTML 파일 생성
- 공통 컴포넌트는 모듈화하여 재사용
- 파일 구조:
  ```
  src/
  ├── soil/        # 토양 (현재)
  ├── water/       # 물
  ├── pesticide/   # 잔류농약
  ├── compost/     # 가축분뇨퇴비
  └── heavy-metal/ # 중금속
  ```

#### 옵션 3: 동적 폼 생성
- 시료 유형 선택 시 폼 필드가 동적으로 변경
- 하나의 HTML 파일에서 JavaScript로 폼 구성
- 설정 파일(JSON)로 각 시료 유형별 필드 정의

---

## 완료된 작업

### 1. UI/UX 개선

#### 검색 모달 디자인
- [x] 둥근 모서리 적용 (border-radius: 12px)
- [x] 검색 아이콘 배경색 추가
- [x] 날짜 입력 테두리 색상 통일
- [x] 검색 버튼 가시성 개선 (투명 → 파란색 배경)

#### 테이블 개선
- [x] 테이블 행 높이 축소 (padding: 0.5rem → 0.35rem)
- [x] 체크박스 선택 기능 추가
  - 전체 선택/해제 체크박스
  - 개별 행 체크박스
  - 부분 선택 시 indeterminate 상태

#### 주소/우편번호 분리
- [x] 우편번호를 별도 숨김 컬럼으로 분리
- [x] 정규식으로 우편번호 파싱: `/^\((\d{5})\)\s*/`
- [x] "전체 보기/기본 보기" 토글 버튼 추가

---

### 2. 라벨 인쇄 기능 (`/label-print`)

#### 기본 기능
- [x] 라벨 인쇄 페이지 생성
- [x] 메인 앱에서 라벨 인쇄로 데이터 전달 (localStorage)
- [x] A4 라벨지 2열 9행 (18개) 템플릿 지원
- [x] 엑셀 파일 업로드 및 파싱
- [x] 샘플 데이터 테스트 기능

#### 시작 위치 선택 기능 (라벨지 절약)
- [x] 시작 위치 선택 UI (1~18번)
- [x] 시각적 그리드 프리뷰 추가
  - 2x9 미니 그리드로 18칸 시각화
  - 클릭으로 시작 위치 선택
  - 색상 구분:
    - 회색: 사용됨 (건너뜀)
    - 보라색: 시작 위치
    - 초록색: 인쇄 영역
  - 범례 추가

---

### 3. 통계 기능

- [x] 통계 버튼 추가 (파란색 그라데이션)
- [x] 통계 모달 UI 구현
- [x] 요약 카드:
  - 총 접수 건수
  - 완료 건수
  - 미완료 건수
- [x] 상세 통계 막대 차트:
  - 시료 타입별 (토양, 물, 잔류농약, 퇴비, 기타)
  - 목적(용도)별 (일반재배, 유기, 무농약, GAP, 저탄소)
  - 월별 접수 현황
  - 수령 방법별 (우편, 이메일, 팩스, 직접방문)

---

### 4. GitHub 배포 설정

#### 데스크톱 앱 배포
- [x] GitHub Actions 워크플로우 설정 (`.github/workflows/build.yml`)
- [x] Windows .exe 자동 빌드
- [x] GitHub Releases 자동 업로드
- [x] 버전 태그 푸시로 배포 트리거

#### 웹 배포 (GitHub Pages)
- [x] `docs/` 폴더 생성
- [x] 웹 버전 파일 복사
- [x] 라벨 인쇄 페이지 경로 수정 (`../src/` → `../`)
- [x] GitHub Pages 설정 가이드 제공

---

### 5. 접수 목록 기능 개선

#### 라벨 인쇄 개선
- [x] 라벨 인쇄 페이지에서 접수목록으로 직접 이동 링크 (`#listView`)
- [x] 라벨 인쇄 시 동일인 중복 제거 (성명+주소 기준)
- [x] 라벨 필드 설정에서 상세주소 옵션 제거 (이름, 주소, 우편번호만 사용)

#### 일괄 처리 기능
- [x] 선택 삭제 버튼 추가 (🗑️ 선택 삭제)
- [x] 체크박스로 선택한 항목 일괄 삭제
- [x] 삭제 전 확인 다이얼로그 및 토스트 알림

#### 자동 저장 기능 개선
- [x] Electron 첫 실행 시 자동 저장 폴더 선택 다이얼로그 표시
- [x] 폴더 선택 후 자동 저장 기본 활성화
- [x] 앱 시작 시 자동 저장 파일에서 데이터 자동 로드
- [x] localStorage가 비어있으면 자동 저장 파일에서 자동 복원

---

## 커밋 히스토리

| 커밋 | 설명 |
|------|------|
| `2616ae3` | fix: 라벨 필드에서 상세주소 제거 및 자동 저장 파일 로드 기능 |
| `e326a80` | feat: 선택 삭제 기능 및 자동 저장 기본 활성화 |
| `d5c4262` | feat: 라벨 인쇄 시 동일인 중복 제거 |
| `adf7232` | feat: 라벨 인쇄 페이지에서 접수목록 뷰로 직접 이동 |
| `6a18c53` | fix: 라벨 필드 설정에서 상세주소 자동매칭 비활성화 |
| `b939d0a` | feat: 라벨 인쇄 기능 통합 및 UI 개선 |
| `b518d4c` | feat: GitHub Pages 웹 배포용 docs 폴더 추가 |
| `b886825` | feat: 라벨 시작 위치 시각적 그리드 선택 UI 추가 |
| `edeb866` | feat: 접수 목록 통계 기능 추가 |

---

## 기술 스택

- **프레임워크**: Electron
- **프론트엔드**: HTML, CSS, JavaScript (Vanilla)
- **스타일링**: Tailwind CSS, Custom CSS
- **라이브러리**:
  - XLSX.js (엑셀 파일 처리)
  - Daum Postcode API (주소 검색)
- **빌드**: Electron Forge
- **CI/CD**: GitHub Actions

---

## 파일 구조

```
sample-log-electron/
├── src/
│   ├── index.html      # 메인 앱 HTML
│   ├── style.css       # 메인 스타일
│   ├── script.js       # 메인 로직
│   ├── cropData.js     # 작물 데이터
│   └── bonghwaData.js  # 지역 데이터
├── label-print/
│   ├── index.html      # 라벨 인쇄 페이지
│   ├── label-app.js    # 라벨 인쇄 로직
│   └── label-print.css # 라벨 인쇄 스타일
├── docs/               # GitHub Pages 웹 버전
│   ├── index.html
│   ├── style.css
│   ├── script.js
│   └── label-print/
└── .github/
    └── workflows/
        └── build.yml   # GitHub Actions 워크플로우
```

---

## 향후 작업 (예정)

### 우선순위 높음 - 시료 유형 확장
- [x] 💧 수질 시료 접수 기능 구현 ✅
- [ ] 🧫 잔류농약 시료 접수 기능 구현
- [ ] 🐄 가축분뇨퇴비 시료 접수 기능 구현
- [ ] ⚠️ 중금속 시료 접수 기능 구현
- [ ] 시료 유형별 통계 분리

### 일반 개선사항
- [ ] 추가 라벨 템플릿 지원 (3x7, 4x6 등)
- [ ] 데이터 백업/복원 기능
- [ ] 인쇄 미리보기 개선
- [ ] 다크 모드 지원
- [ ] macOS 빌드 추가
- [ ] 검사 결과 입력 및 관리 기능
- [ ] 결과 보고서 출력 기능
